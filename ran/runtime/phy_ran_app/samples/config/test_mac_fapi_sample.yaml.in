# SPDX-FileCopyrightText: Copyright (c) 2025 NVIDIA CORPORATION & AFFILIATES. All rights reserved.
# SPDX-License-Identifier: Apache-2.0
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# MAC configuration file for testing with fapi_sample
---
aerial_sdk_version: 25-3-cubb
name: test_mac_with_fapi_sample
class: test_mac

# log file name
log_name: testmac_fapi_sample.log

# Set to yaml file like test_cumac_config.yaml to enable cuMAC-CP test
test_cumac_config_file: null

oam_server_addr: 0.0.0.0:50052

# CPU core shared by all low-priority threads
low_priority_core: -1

sched_thread_config:
  name: mac_sched
  cpu_affinity: -1
  sched_priority: 50

recv_thread_config:
  name: mac_recv
  cpu_affinity: -1
  sched_priority: 50

builder_thread_config:
  name: fapi_builder
  cpu_affinity: -1
  sched_priority: 50

# Dynamic SFN/Slot
enableTickDynamicSfnSlot: 0

# Enable FAPI builder thread
builder_thread_enable: 0

# For estimating sending ahead time for STT feature
estimate_send_time: -1

# STT: L2 scheduler total time of a slot (unit: ns). Set 0 to disable this feature.
schedule_total_time: 0

# FAPI message bit mask
fapi_delay_bit_mask: 0

# Duplicate SLOT FAPI test
duplicate_fapi_bit_mask: 0
duplicate_fapi_num_max: 1

# Worker thread cores
worker_cores: []

# restart_option: 0 - No CONFIG.req
restart_option: 0

# Total slot number in test (0 = run indefinitely)
# Configurable at runtime via TEST_SLOTS environment variable
test_slots: @TEST_SLOTS@
restart_interval: 0

# For single cell restart test
cell_run_slots: 0
cell_stop_slots: 0

# Wait before sending next cell CONFIG.req
cell_config_wait: 20
cell_config_timeout: 2000
cell_config_retry: 5

# Send cell config/start/stop request via OAM command
oam_cell_ctrl_cmd: 0

# Deadline timings (all in nanoseconds)
early_harq_deadline_ns: 2000000
ul_ind_deadline_ns: 4500000
prach_ind_deadline_ns: 4500000
uci_ind_deadline_ns: 4500000
srs_late_deadline_ns: 5500000
srs_early_deadline_ns: 1759000

# For cell net parameters update test
test_cell_update:
  test_cells: []
  test_sequence:
  - slot_point: 0
    configs:
      - {cell_id: 0, dst_mac: "26:04:9D:9E:29:B3", vlan: 2, pcp: 7}

# SHM IPC DL notify mode: 0 - notify per cell, 1 - notify per TTI, 2 - notify per message
ipc_sync_mode: 0

# FAPI indication validating
validate_enable: 1
validate_log_opt: 1

# Enable FAPI TV map to reuse duplicate PDU data
tv_data_map_enable: 1

# Enable dummy DL_TTI and UL_TTI request
enable_dummy_tti: 0

# FAPI TB data location option. 0 - CPU_MSG; 1 - CPU_DATA; 2 - CUDA_DATA
fapi_tb_loc: 1

# PDSCH TB align bytes
pdsch_align_bytes: 1

# Enable CSI P2 FAPI V3
enable_csip2_v3: 0

# SRS validation option
srs_vald_sample_num: 100

# Transport settings for nvIPC - must match phy_ran_app settings
transport:
  type: shm
  shm_config:
    prefix: phy_ran_app
    primary: 0
    cuda_device_id: -1

# Cell configuration (same as default test_mac_config.yaml)
message: cell_config_request
data:
  nCarrierIdx: 0
  nDMRSTypeAPos: 2
  nNrOfTxAnt: 8
  nNrOfRxAnt: 4
  nSubcCommon: 1
  numTDDPattern: 1
  TDDPeriod:
    - 3
    - 0
  nSSBAbsFre: 3313920
  nDLAbsFrePointA: 3301680
  nULAbsFrePointA: 3301680
  nDLK0: 1
  nULK0: 1
  nDLFftSize: 4096
  nULFftSize: 4096
  nCarrierAggregationLevel: 0
  nFrameDuplexType: 1
  nPhyCellId: 41
  nSSBPwr: 1
  nSSBSubcSpacing: 2
  nSSBPeriod: 2
  nSSBSubcOffset: 0
  nSSBMask:
    - 0
    - 0
  nMIB:
    - 1
    - 13
    - 4
  nPrachConfIdx: 158
  nPrachSubcSpacing: 1
  nPrachRootSeqIdx: 137
  nPrachZeroCorrConf: 5
  nPrachRestrictSet: 0
  nPrachFdm: 1
  nPrachFreqStart: 3
  nPrachSsbRach: 3
  rsrpMeasurement: 1
  pnMeasurement: 1
  pf_234_interference: 1
  prach_interference: 1
  pusch_aggr_factor: 1
  channel_segment_timelines: 0

indicationPerSlot:
  rxDataIndPerSlot: 0
  crcIndPerSlot: 0
  uciIndPerSlot: 0
  rachIndPerSlot: 0
  srsIndPerSlot: 0
  dlTTIrspPerSlot: 0

conf_test:
  conf_test_enable: 0
  conf_test_slots: 75000
  conformance_test_start_time: 480000
  prach:
    expect_prmbindexes: 0
    delay_error_tolerance: 0.5
  pusch:
  pucch:
    ack_nack_pattern: 01
  stats_file: "conformance_test_stats_file.txt"
